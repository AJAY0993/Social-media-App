import{a as h,b as x,c as j,l as m,_ as g,d as b,j as s,E as _,L as d,B as v,e as f,s as w,r as y}from"./index-B3tnE4R3.js";import{i as p}from"./isValidEmail-D0JiuvvC.js";import{u as N}from"./useBack-BPnmedfD.js";import{l as k}from"./authApi-DMcg74op.js";const P="_login__container_tbevj_13",L="_img__container_tbevj_29",S="_post__bg_tbevj_43",E="_login__heading_tbevj_61",q="_login__text_tbevj_73",C="_login__form_tbevj_85",B="_link_tbevj_95",a={"btn--back":"_btn--back_tbevj_1",login__container:P,img__container:L,post__bg:S,login__heading:E,login__text:q,login__form:C,link:B};function D(){const o=h(),r=x(),{mutate:i,isPending:t}=j({mutationFn:n=>k(n),onSuccess:n=>{o(m(n)),g.success("Welcome Back"),r.invalidateQueries({queryKey:[`user:${n._id}`]})},onError:n=>{g.error(n.message)}});return{login:i,isLoggingIn:t}}function M(){const{login:o,isLoggingIn:r}=D(),{register:i,handleSubmit:t,formState:n}=b(),{errors:e}=n,c=N();return s.jsx("section",{className:"login",children:s.jsx("div",{className:"container",children:s.jsxs("div",{children:[s.jsxs("button",{className:"btn btn__primary btn--square "+a["btn--back"],onClick:c,children:[" ",s.jsx("img",{src:"/images/icons/back.png"})]}),s.jsxs("div",{className:a.login__container,children:[s.jsxs("div",{className:a.img__container,children:[s.jsx("img",{src:"images/post-portrait.png",alt:"phone"}),s.jsx("img",{src:"images/post-portrait-2.png",alt:"phone",className:a.post__bg})]}),s.jsxs("div",{children:[s.jsx("h1",{className:a.login__heading,children:"Hello Again!"}),s.jsx("p",{className:a.login__text,children:"Sign in to your account"}),s.jsxs("form",{method:"POST",className:"login__form",onSubmit:t(o),children:[s.jsxs("div",{children:[s.jsx("input",{type:"email",className:"inp inp__secondary",placeholder:"Enter your email",...i("email",{required:"This field is required",validate:l=>p(l)||"Please provide a valid email"})}),(e==null?void 0:e.email)&&s.jsx(_,{message:e.email.message})]}),s.jsxs("div",{children:[s.jsx("input",{type:"text",className:"inp inp__secondary",placeholder:"Enter your password",...i("password",{required:"Please provide this field",minLength:{value:8,message:"Password must be 8 characters long"},maxLength:{value:20,message:"Password should not be larger than 20 characters"}})}),(e==null?void 0:e.password)&&s.jsx(_,{message:e.password.message})]}),s.jsx(d,{className:a.link,to:"/forgotPassword",children:"Forgot password ?"}),s.jsx(v,{type:"primary",disabled:r,children:"Log in"})]}),s.jsxs("div",{children:[s.jsx("span",{className:a.line,children:"---------------"}),s.jsx("span",{children:"or with"}),s.jsx("span",{className:a.line,children:"---------------"}),s.jsxs("button",{className:"btn btn__secondary",disabled:!0,children:[s.jsx("img",{src:"images/icons/google.png",alt:"google"})," Continue with google"]}),s.jsxs("button",{className:"btn btn__secondary",children:[s.jsx("img",{src:"images/icons/twitter.png",alt:"google"}),"Continue with twitter"]}),s.jsxs("p",{className:a.login__text,children:["Dont have an account?"," ",s.jsx(d,{className:a.link,to:"/signup",children:"Sign up"})]})]})]})]})]})})})}async function O({request:o,params:r}){const i=await o.formData(),t=i.get("email"),n=i.get("password"),e={};if(p(t)||(e.email="Please provide a valid email"),n.length<8&&(e.password="Password must be 8 chracter long"),e.email||e.password)return e;const c={method:"POST",url:"http://localhost:3000/api/users/login",withCredentials:!0,data:{email:t,password:n}};try{const u=(await f(c)).data.data.user;return w.dispatch(m(u)),y("/home")}catch(l){alert(l.response.data.message)}return null}export{O as action,M as default};
