import{v as d,j as e,g as x,f as b,_ as w,p as N,u as S,N as h,Z as k,O as M,o as B,B as f,a1 as I,U as C,a2 as P,a3 as R}from"./index-DVVaJp0R.js";import{u as A}from"./useBack-BNJulS5h.js";import{u as F}from"./useProfile-gNo5Grlv.js";const U="_message_xjn6k_1",E="_sent_xjn6k_19",H="_recieved_xjn6k_43",l={message:U,sent:E,recieved:H},v=d.forwardRef(function({showImg:s=!1,message:a},r){const o=!!a.sent;return e.jsxs("div",{className:l.message__container+" "+(o?l.sent:l.recieved),ref:r,children:[s&&e.jsx("img",{className:"btn--circle",src:"https://i.ibb.co/mBXRT6g/profile-user.png",alt:"profile-user",border:"0"}),e.jsx("p",{className:l.message,children:a.message||"Lorem ipsum, dolor sit amet consectetur adipisicing elit. Laudantium,magni."})]})});function L(){const[s,a]=d.useState(),{recieverId:r}=x();async function o(t){try{a(!0);const _=(await b("messages",{method:"POST",data:{recieverId:r,message:t}})).data.data.message;return a(!1),_}catch(m){w.error(m.response.data.message),a(!1)}}return{sendMessage:o,isSending:s}}const $="_messageBox_8a5pb_1",q="_header_8a5pb_13",O="_back__btn_wrapper_8a5pb_29",T="_user_8a5pb_39",D="_secondaryHeader_8a5pb_55",K="_btn__wrapper_8a5pb_67",Q="_messages__container_8a5pb_75",V="_form__container_8a5pb_91",X="_form_8a5pb_91",n={messageBox:$,header:q,back__btn_wrapper:O,user:T,secondaryHeader:D,btn__wrapper:K,messages__container:Q,form__container:V,form:X};function Z(){const{recieverId:s}=x(),{data:a,isFetchingMessages:r}=N({queryFn:async()=>{try{return(await b(`conversations/to?reciever=${s}`)).data.data.messages}catch{return[]}},queryKey:[`messages:${s}`]});return{messages:a,isFetchingMessages:r}}function Y(){const s=d.useRef(),a=S(),{recieverId:r}=x(),o=h(k)||[],{profile:t,isProfileLoading:m}=F(),[_,c]=d.useState([]),u=h(M),p=A(),j=o.includes(r)?"online":"offline",{messages:g,isFetchingMessages:y}=Z();return d.useEffect(()=>{setTimeout(()=>{var i;return(i=s.current)==null?void 0:i.scrollIntoView({behavior:"smooth"})},500)},[_]),y||m?e.jsx(B,{}):e.jsxs("section",{className:n.messageBox,children:[e.jsxs("div",{className:n.header,children:[e.jsx("div",{className:n.back__btn_wrapper,children:e.jsx(f,{type:"primary",variation:"square",onClick:p,children:e.jsx(I,{})})}),e.jsx(C,{showBtn:!1,customClass:n.user,user:t,secondaryCaption:j})]}),e.jsxs("div",{className:n.box,children:[e.jsxs("article",{className:n.secondaryHeader+" flex",children:[e.jsx("h3",{children:t.username}),e.jsx("div",{className:n.btn__wrapper,children:e.jsx(f,{type:"primary",variation:"rounded",onClick:()=>a(`/profile/${t._id}`),children:"Profile"})})]}),e.jsx("div",{className:n.messages__container+" flex",children:g==null?void 0:g.map(i=>e.jsx(v,{ref:s,message:{...i,sent:i.sender===u}},Math.random()))}),e.jsx("div",{className:n.messages__container+" flex",children:_.map(i=>e.jsx(v,{message:i,ref:s},Math.random()))}),e.jsx(z,{setMessages:c})]})]})}function z({setMessages:s}){const[a,r]=d.useState(""),{sendMessage:o}=L(),{socket:t}=P(),m=new Audio("/audio/sent.mp3"),_=c=>{c.preventDefault(),s(u=>[...u,{message:a,sent:!0}]),o(a),r(""),m.play()};return d.useEffect(()=>{const c=new Audio("/audio/notif.mp3");return t.on("event:message",u=>{s(p=>[...p,u]),c.play()}),()=>t.off("event:message")},[s,t]),e.jsx("footer",{className:n.form__container,children:e.jsxs("form",{className:"flex "+n.form,action:"",onSubmit:_,children:[e.jsx("input",{className:"inp inp__secondary",type:"text",value:a,onChange:c=>r(c.target.value)}),e.jsx(f,{type:"primary",variation:"rounded",width:"fit",children:e.jsx(R,{})})]})})}export{Y as default};
