import{o as d,j as e,g as x,f as j,_ as w,h as S,u as N,H as h,T as k,J as M,i as B,B as f,X as I,U as C,Y as P,Z as R}from"./index-BOkKEmcp.js";import{u as A}from"./useBack-Cpm9vfjg.js";import{u as F}from"./useProfile-B2RFocM7.js";const H="_message_xjn6k_1",U="_sent_xjn6k_19",E="_recieved_xjn6k_43",l={message:H,sent:U,recieved:E},b=d.forwardRef(function({showImg:s=!1,message:a},r){const o=!!a.sent;return e.jsxs("div",{className:l.message__container+" "+(o?l.sent:l.recieved),ref:r,children:[s&&e.jsx("img",{className:"btn--circle",src:"https://i.ibb.co/mBXRT6g/profile-user.png",alt:"profile-user",border:"0"}),e.jsx("p",{className:l.message,children:a.message||"Lorem ipsum, dolor sit amet consectetur adipisicing elit. Laudantium,magni."})]})});function L(){const[s,a]=d.useState(),{recieverId:r}=x();async function o(t){try{a(!0);const _=(await j("messages",{method:"POST",data:{recieverId:r,message:t}})).data.data.message;return a(!1),_}catch(m){w.error(m.response.data.message),a(!1)}}return{sendMessage:o,isSending:s}}const T="_messageBox_8a5pb_1",$="_header_8a5pb_13",q="_back__btn_wrapper_8a5pb_29",O="_user_8a5pb_39",X="_secondaryHeader_8a5pb_55",D="_btn__wrapper_8a5pb_67",J="_messages__container_8a5pb_75",K="_form__container_8a5pb_91",Q="_form_8a5pb_91",n={messageBox:T,header:$,back__btn_wrapper:q,user:O,secondaryHeader:X,btn__wrapper:D,messages__container:J,form__container:K,form:Q};function V(){const{recieverId:s}=x(),{data:a,isFetchingMessages:r}=S({queryFn:async()=>{try{return(await j(`conversations/to?reciever=${s}`)).data.data.messages}catch{return[]}},queryKey:[`messages:${s}`]});return{messages:a,isFetchingMessages:r}}function W(){const s=d.useRef(),a=N(),{recieverId:r}=x(),o=h(k)||[],{profile:t,isProfileLoading:m}=F(),[_,c]=d.useState([]),u=h(M),p=A(),v=o.includes(r)?"online":"offline",{messages:g,isFetchingMessages:y}=V();return d.useEffect(()=>{setTimeout(()=>{var i;return(i=s.current)==null?void 0:i.scrollIntoView({behavior:"smooth"})},500)},[_]),y||m?e.jsx(B,{}):e.jsxs("section",{className:n.messageBox,children:[e.jsxs("div",{className:n.header,children:[e.jsx("div",{className:n.back__btn_wrapper,children:e.jsx(f,{type:"primary",variation:"square",onClick:p,children:e.jsx(I,{})})}),e.jsx(C,{showBtn:!1,customClass:n.user,user:t,secondaryCaption:v})]}),e.jsxs("div",{className:n.box,children:[e.jsxs("article",{className:n.secondaryHeader+" flex",children:[e.jsx("h3",{children:t.username}),e.jsx("div",{className:n.btn__wrapper,children:e.jsx(f,{type:"primary",variation:"rounded",onClick:()=>a(`/profile/${t._id}`),children:"Profile"})})]}),e.jsx("div",{className:n.messages__container+" flex",children:g==null?void 0:g.map(i=>e.jsx(b,{ref:s,message:{...i,sent:i.sender===u}},Math.random()))}),e.jsx("div",{className:n.messages__container+" flex",children:_.map(i=>e.jsx(b,{message:i,ref:s},Math.random()))}),e.jsx(Y,{setMessages:c})]})]})}function Y({setMessages:s}){const[a,r]=d.useState(""),{sendMessage:o}=L(),{socket:t}=P(),m=new Audio("/audio/sent.mp3"),_=c=>{c.preventDefault(),s(u=>[...u,{message:a,sent:!0}]),o(a),r(""),m.play()};return d.useEffect(()=>{const c=new Audio("/audio/notif.mp3");return t.on("event:message",u=>{s(p=>[...p,u]),c.play()}),()=>t.off("event:message")},[s,t]),e.jsx("footer",{className:n.form__container,children:e.jsxs("form",{className:"flex "+n.form,action:"",onSubmit:_,children:[e.jsx("input",{className:"inp inp__secondary",type:"text",value:a,onChange:c=>r(c.target.value)}),e.jsx(f,{type:"primary",variation:"rounded",width:"fit",children:e.jsx(R,{})})]})})}export{W as default};
